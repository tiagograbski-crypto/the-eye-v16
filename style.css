/* === script.js: LÓGICA COMPLETA V21 === */

const NIVEIS_RISCO = {
    ESTAVEL: 'verde',
    ATENCAO: 'amarelo',
    ALERTA: 'marrom', 
    EMERGENCIA: 'vermelho' 
};

let statusAmeacaEnergia = NIVEIS_RISCO.ALERTA; 
let statusAmeacaInternet = NIVEIS_RISCO.ALERTA; 
let modoAtual = 'geopolitico'; 


function monitorarAmeacas() {
    const mapaRisco = document.getElementById('mapa-risco');
    const alertaGatilho = NIVEIS_RISCO.ALERTA; 

    // LÓGICA DE GATILHO AUTOMÁTICO (Foco: Geopolítico / Crise)
    if (statusAmeacaEnergia === NIVEIS_RISCO.EMERGENCIA || statusAmeacaInternet === NIVEIS_RISCO.EMERGENCIA || statusAmeacaEnergia === alertaGatilho || statusAmeacaInternet === alertaGatilho) {
        if (modoAtual !== 'crise') {
            trocarModo('crise');
        }
    } else if (modoAtual !== 'geopolitico') {
        // Volta para o modo geopolítico se não houver crise ativa
        trocarModo('geopolitico');
    }

    // ATUALIZA A COR DO MAPA
    let maiorRisco = NIVEIS_RISCO.ESTAVEL;
    if (statusAmeacaEnergia === NIVEIS_RISCO.EMERGENCIA || statusAmeacaInternet === NIVEIS_RISCO.EMERGENCIA) {
        maiorRisco = NIVEIS_RISCO.EMERGENCIA;
    } else if (statusAmeacaEnergia === NIVEIS_RISCO.ALERTA || statusAmeacaInternet === NIVEIS_RISCO.ALERTA) {
        maiorRisco = NIVEIS_RISCO.ALERTA;
    }

    mapaRisco.className = ''; 
    mapaRisco.classList.add('risco-' + maiorRisco);
}

function trocarModo(modoNovo) {
    if (modoAtual === modoNovo) return;
    
    // 1. Oculta todos os painéis e remove a classe 'ativo'
    document.querySelectorAll('.modo-painel').forEach(panel => {
        panel.classList.remove('ativo'); 
        panel.style.display = 'none'; // JS ESCONDE TUDO
    });
    document.querySelectorAll('.btn-modo').forEach(button => {
        button.classList.remove('ativo');
    });

    // 2. Exibe o painel selecionado
    const painelSelecionado = document.getElementById('modo-' + modoNovo);
    if (painelSelecionado) {
        painelSelecionado.classList.add('ativo');
        painelSelecionado.style.display = 'block'; // JS MOSTRA O ATIVO
    }

    // 3. Marca o botão
    const botaoSelecionado = document.querySelector('.btn-modo[data-modo="' + modoNovo + '"]');
    if (botaoSelecionado) {
        botaoSelecionado.classList.add('ativo');
    }
    modoAtual = modoNovo;
}


function fecharAlertaPrioritario() {
    document.getElementById('alerta-prioridade').style.display = 'none';
}

function toggleHistorico() {
    const detalhes = document.getElementById('detalhes-historico');
    if (detalhes.style.display === 'none' || detalhes.style.display === '') {
        detalhes.style.display = 'block';
    } else {
        detalhes.style.display = 'none';
    }
}


document.addEventListener('DOMContentLoaded', () => {
    // Liga os event listeners para todos os botões de modo
    document.querySelectorAll('.btn-modo').forEach(button => {
        button.addEventListener('click', function() {
            trocarModo(this.getAttribute('data-modo'));
        });
    });
    
    // Inicializa o modo e a classe de botão
    document.querySelector('.btn-modo[data-modo="geopolitico"]').classList.add('ativo');
    
    // Inicia a monitoração de ameaças
    setInterval(monitorarAmeacas, 5000); 
    monitorarAmeacas();
});
